<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelUp: Nuovo itinerario</title>
    <link rel="icon" type="image/x-icon" href="assets/favicons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
    <link rel="manifest" href="assets/favicons/site.webmanifest">

    <link rel="stylesheet" href="/css/aos.css"> <!-- AOS CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"> <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/all.min.css"> <!-- FontAwesome -->
    <link rel="stylesheet" href="/css/crea_itinerario.css">

</head>

<body>

    <!-- inizio sezione header -->

    <header>

        <div class="container">

            <a class="navbar-brand logo" href="/">
                <img src="/assets/images/logoleft.png" style="max-width: 175px; height: auto;" alt="">
            </a>

            <nav class="nav">
                <ul>
                    <% if (!user) { %>
                        <div class="loginLink">
                            <li><a href="#home">Accedi</a></li>
                        </div>
                        <% } else { %>
                            <li><a href="/itinerari">Torna alla dashboard</a></li>
                            <li><a href="/logout">Esci</a></li>
                            <% } %>
                </ul>
            </nav>

            <div class="fas fa-bars">
            </div>

        </div>

    </header>

    <!-- fine sezione header -->

    <!-- inizio sezione home -->

    <section class="home" id="home">
        <div class="container pt-5" >
            <div class="container-fluid min-vh-100 pt-5 mt-5 w-100">
                <div class="row align-items-start w-100 ">
                    <div class="col">
                        <div>
                            <form id="form">
                                <label >Città</label>
                                <input type="text" placeholder="Inserisci la città" autocomplete="off" id="citta">
                                <button id="Search">Search</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="space">
                </div>
                <div class="row itinerari">
                    <div class="col-4 gestioneItinerari ps-3"> 
                        <div class="row tappeItinerario ">
                           <label> Il Tuo Itinerario </label>
                           <div class="list-group scrollInfo">
                                <ul id="Viewer">

                                </ul>
                            </div>
                        </div>
                        <div class="row d-flex justify-content-between align-items-start">
                            <button class="button" id="salva">Salva</button>
                        </div>
                    </div>
                    <div class="col interesse">
                        <label>Scopri luoghi d'interesse</label>
                        <nav class="navbar navbar-expand-lg navbar-light">
                            <div class="container-fluid">
                                <span class="navbar" data-bs-toggle="collapse" data-bs-traget="#ItinerarioAnalisi" aria-controls="ItinerarioAnalisi" aria-expanded="false"></span>
                                <div class="collapse navbar-collapse" id="ItinerarioAnalisi">
                                    <div class="w-100 navbar-nav me-auto mb-2 mb-lg-0">
                                        <button class="button nav-item nav-link active border" type="button" id="Cultura">Cultura</button>
                                        <button class="button nav-item nav-link active border" type="button" id="Utility" >Servizi</button>
                                        <button class="button nav-item nav-link active border" type="button" id="Food">Food</button>
                                        <button class="button nav-item nav-link active border" type="button" id="Intrattenimento">Intrattenimento</button>
                                    </dvi>
                                </div>
                            </div>
                        </nav>
                        <div class="list-group scrollInfo">
                            <ul class="infotappe" id="infotappe">
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

        </div>    
    </section>

    <!-- fine sezione home -->
    <!-- inizio sezione footer  -->

    <section class="footer">

        <h1 class="credit text-center mx-auto homecredit">© Copyright 2022 TravelUp
            ®<span></span><br>Tutti i diritti riservati.<br><a
                href="https://github.com/TUEngineers/TravelUp">github.com/TUEngineers/TravelUp</a></h1>

    </section>


    <!-- fine sezione footer -->

    <script src="/js/aos.js"></script> <!-- AOS JS -->
    <script src="/js/bootstrap.bundle.min.js"></script> <!-- Bootstrap JS -->
    <script src="/js/jquery.min.js"></script> <!-- jQuery -->
    <script src="/js/main.js"></script>
    <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script><!-- Socket.IO-->

    <script>
        AOS.init({
            duration: 1000,
            delay: 10
        });
    </script>
    <script>
        var citta = '';
        var target = 'Cultura';
        const socket = io("http://localhost:1337")
        socket.on('connect',()=>{
            socket.emit('room', {room_name: 'clients'});
        });
        var form = document.getElementById('form');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if(!$('input#citta').val()){
                alert('Inserire una citta');
            }else{
                citta = $('input#citta').val();
                socket.emit('Luoghi',{citta,target})
            }
        });

        $('button#Cultura').on('click',()=>{
            target = 'Cultura';
            if(!$('input#citta').val()){
                alert('Inserire una citta');
            }else{
                citta = $('input#citta').val();
                socket.emit('Luoghi',{citta,target})
                $('button').removeClass("selected").removeAttr('disabled');
                $('button#Musei').addClass("selected").attr('disabled',true);
            }
        })

        $('button#Utility').on('click',()=>{
            target = 'Utility';
            if(!$('input#citta').val()){
                alert('Inserire una citta');
            }else{
                citta = $('input#citta').val();
                socket.emit('Luoghi',{citta,target})
                $('button').removeClass("selected").removeAttr('disabled');
                $('button#Utility').addClass("selected").attr('disabled',true);
            }
        })

        $('button#Food').on('click',()=>{
            target = 'Food';
            if(!$('input#citta').val()){
                alert('Inserire una citta');
            }else{
                citta = $('input#citta').val();
                socket.emit('Luoghi',{citta,target})
                $('button').removeClass("selected").removeAttr('disabled');
                $('button#Food').addClass("selected").attr('disabled',true);
            }
        })

        $('button#Intrattenimento').on('click',()=>{
            target = 'Intrattenimento';
            if(!$('input#citta').val()){
                alert('Inserire una citta');
            }else{
                citta = $('input#citta').val();
                socket.emit('Luoghi',{citta,target})
                $('button').removeClass("selected").removeAttr('disabled');
                $('button#Intrattenimento').addClass("selected").attr('disabled',true);
            }
        })

        function showInformation(informazione){
            info = informazione;
            lista = document.getElementsByClassName('infotappe')
            $(lista).empty()
            for(let key in info){
                titolo = info[key]['title']
                desc = info[key]['desc']
                if(typeof desc === 'undefined'){
                    desc = "";
                }
                link = info[key]['url']
                $(lista).append(`<li class="list-group-item d-flex justify-content-between align-items-start element-view ">      \
                                                <div class="ms-2 me-2 tappa">  \
                                        <div class="d-flex justify-content-between align-items-start">\
                                            <div class="fw-bold titoloTappa">\
                                                `+titolo+`\
                                            </div>\
                                            <div id="button">\
                                                <button class="badge bg-primary rounded-pill" id="add">Add</button>\
                                            </div>\
                                        </div>\
                                            <div class="descriptionBox">\
                                                `+desc+`\
                                            </div>\
                                            <div class="findmore">\
                                                <a href="`+link+`" target="_blank" >Scopri di piu...</a>\
                                            </div>\
                                    </div>\
                                </li>`)
            }
            createList(lista);
            
        }

        function createList(lista){
            $(lista).find('.rounded-pill').on('click', function(){
                    element = $(this).parents('.element-view').clone().find('div#button,div.descriptionBox,div.findmore').remove().end().html();
                    element = $(element).children().append('<div><button id="up" class="badge bg-primary rounded-pill">▲</button></div>\
                                                            <div><button id="down" class="badge bg-primary rounded-pill">▼</button></div>\
                                                            <div><button id="remove" class="badge bg-primary rounded-pill">Rimuovi</button></div>')
                    $(element).children().children("#remove").on('click', function(){
                        $(this).parentsUntil("ul").remove();
                    });
                    $(element).children().children("#up").on('click', function(){
                        moveUp($(this).parent().parent().parent());
                    });
                    $(element).children().children("#down").on('click', function(){
                        moveDown($(this).parent().parent().parent());
                    });            
                    element = element.wrap('<li class="list-group-item border-bottom border-start"></li>').parent();
                    element = $(element).append('<div class="d-flex justify-content-between align-items-start"><label>Giorno :</label><input type="date" id="giorno" name="giorno"></div>')
                    $('#Viewer').append(element);
                });

        }
        
        function moveUp($item){
            $before = $item.prev();
            $item.insertBefore($before);
        }

        function moveDown($item){
            $after = $item.next();
            $item.insertAfter($after);
        }
        
        function saveItinerario(){
            var tappe = [];
            $('#Viewer li').each(function(){
                var html = $(this).html();
                alert(html);
            })
        }

        $('button#salva').on('click',()=>{
            saveItinerario();
        })






        socket.on('luoghi_rispostaClient', (data)=>{
            switch (data.target){
                case 'Cultura':{
                    showInformation(data.value);
                    break;
                }
                case 'Food':{
                    showInformation(data.value);
                    break;
                }
                case 'Intrattenimento':{
                    showInformation(data.value);
                    break;
                };
                case 'Utility':{
                    showInformation(data.value);
                    break;
                };
                }
            })
        
    </script>
</body>

</html>